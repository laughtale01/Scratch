<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Minecraft Ã— Scratch å°‚ç”¨ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .header {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.3);
        }
        .status-bar {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            text-align: center;
            font-size: 14px;
        }
        .connection-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .connected { background-color: #4CAF50; }
        .disconnected { background-color: #f44336; }
        .controls {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .control-group {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            margin: 5px;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
            font-size: 12px;
        }
        .btn:hover { background: #45a049; }
        .btn:disabled { background: #888; cursor: not-allowed; }
        input[type="text"], input[type="number"] {
            padding: 5px;
            border: none;
            border-radius: 3px;
            margin: 2px;
            width: 60px;
        }
        .log {
            background: rgba(0,0,0,0.7);
            color: #00ff00;
            font-family: monospace;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            margin: 10px;
            border-radius: 5px;
        }
        .visual-blocks {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 10px;
            border-radius: 8px;
        }
        .block {
            background: #4CAF50;
            color: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            margin-right: 10px;
        }
        .block:hover { background: #45a049; }
        .script-area {
            background: rgba(255,255,255,0.2);
            min-height: 100px;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 2px dashed rgba(255,255,255,0.5);
        }
        .script-block {
            background: #2196F3;
            color: white;
            padding: 8px 12px;
            margin: 3px;
            border-radius: 5px;
            display: inline-block;
            cursor: move;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® Minecraft Controller</h1>
        <p>ç°¡å˜ãƒ–ãƒ­ãƒƒã‚¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°</p>
    </div>

    <div class="status-bar">
        <span class="connection-dot disconnected" id="status-dot"></span>
        <span id="status-text">Minecraftæ¥ç¶šãƒã‚§ãƒƒã‚¯ä¸­...</span>
        <button onclick="connectToMinecraft()" id="connect-btn" class="btn">ğŸ”Œ æ¥ç¶š</button>
    </div>

    <div class="visual-blocks">
        <h3>ğŸ“¦ ä½¿ç”¨å¯èƒ½ãƒ–ãƒ­ãƒƒã‚¯</h3>
        <div class="block" onclick="addBlock('connect')">ğŸ”Œ Minecraftã«æ¥ç¶š</div>
        <div class="block" onclick="addBlock('place')">ğŸ§± ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç½®ã</div>
        <div class="block" onclick="addBlock('chat')">ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</div>
        <div class="block" onclick="addBlock('wait')">â³ å¾…ã¤</div>
        <div class="block" onclick="addBlock('loop')">ğŸ”„ ãã‚Šã‹ãˆã—</div>
        
        <h4>ğŸ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒªã‚¢</h4>
        <div class="script-area" id="script-area">
            ã“ã“ã«ãƒ–ãƒ­ãƒƒã‚¯ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
        </div>
        <button onclick="runScript()" class="btn" style="background: #FF9800; font-size: 16px;">â–¶ï¸ å®Ÿè¡Œ</button>
        <button onclick="clearScript()" class="btn" style="background: #f44336;">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
    </div>

    <div class="controls">
        <div class="control-group">
            <h4>ğŸ§± ãƒ–ãƒ­ãƒƒã‚¯è¨­ç½®</h4>
            <select id="block-type">
                <option value="stone">çŸ³ (stone)</option>
                <option value="dirt">åœŸ (dirt)</option>
                <option value="grass_block">è‰ (grass_block)</option>
                <option value="wood">æœ¨æ (wood)</option>
                <option value="glass">ã‚¬ãƒ©ã‚¹ (glass)</option>
                <option value="red_wool">èµ¤ç¾Šæ¯› (red_wool)</option>
                <option value="blue_wool">é’ç¾Šæ¯› (blue_wool)</option>
                <option value="diamond_block">ãƒ€ã‚¤ãƒ¤ (diamond_block)</option>
                <option value="gold_block">é‡‘ (gold_block)</option>
            </select><br>
            X: <input type="number" id="x-coord" value="0">
            Y: <input type="number" id="y-coord" value="70">
            Z: <input type="number" id="z-coord" value="0"><br>
            <button onclick="placeBlock()" class="btn">ğŸ§± ç½®ã</button>
            <button onclick="getPlayerPos()" class="btn">ğŸ“ ç¾åœ¨ä½ç½®</button>
        </div>

        <div class="control-group">
            <h4>ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ</h4>
            <input type="text" id="chat-message" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸" style="width: 150px;">
            <button onclick="sendChat()" class="btn">ğŸ“¤ é€ä¿¡</button>
        </div>

        <div class="control-group">
            <h4>ğŸ—ï¸ å»ºç¯‰ãƒ˜ãƒ«ãƒ‘ãƒ¼</h4>
            <button onclick="buildTower()" class="btn">ğŸ—¼ å¡”ã‚’ä½œã‚‹</button>
            <button onclick="buildWall()" class="btn">ğŸ§± å£ã‚’ä½œã‚‹</button>
            <button onclick="buildFloor()" class="btn">ğŸŸ« åºŠã‚’ä½œã‚‹</button>
        </div>
    </div>

    <div class="log" id="log">
        Minecraft Controller åˆæœŸåŒ–ä¸­...<br>
    </div>

    <script>
        let ws = null;
        let connected = false;
        let script = [];

        function log(message) {
            const logElement = document.getElementById('log');
            logElement.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(isConnected, message) {
            connected = isConnected;
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const btn = document.getElementById('connect-btn');
            
            dot.className = 'connection-dot ' + (isConnected ? 'connected' : 'disconnected');
            text.textContent = message;
            btn.disabled = isConnected;
            
            log(message);
        }

        function connectToMinecraft() {
            if (ws) {
                ws.close();
            }

            try {
                ws = new WebSocket('ws://localhost:14711');
                
                ws.onopen = function() {
                    updateStatus(true, 'Minecraftæ¥ç¶šæˆåŠŸï¼');
                };
                
                ws.onmessage = function(event) {
                    log('å—ä¿¡: ' + event.data);
                };
                
                ws.onclose = function() {
                    updateStatus(false, 'Minecraftæ¥ç¶šåˆ‡æ–­');
                };
                
                ws.onerror = function() {
                    updateStatus(false, 'Minecraftæ¥ç¶šã‚¨ãƒ©ãƒ¼');
                };
                
            } catch (error) {
                updateStatus(false, 'WebSocketæ¥ç¶šå¤±æ•—: ' + error.message);
            }
        }

        function sendCommand(command) {
            if (!connected || !ws) {
                log('âŒ Minecraftã«æ¥ç¶šã—ã¦ãã ã•ã„');
                return false;
            }
            
            try {
                ws.send(JSON.stringify(command));
                log('é€ä¿¡: ' + JSON.stringify(command));
                return true;
            } catch (error) {
                log('âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: ' + error.message);
                return false;
            }
        }

        function placeBlock() {
            const blockType = document.getElementById('block-type').value;
            const x = parseInt(document.getElementById('x-coord').value);
            const y = parseInt(document.getElementById('y-coord').value);
            const z = parseInt(document.getElementById('z-coord').value);
            
            sendCommand({
                command: 'setBlock',
                args: { x: x, y: y, z: z, blockType: blockType }
            });
        }

        function sendChat() {
            const message = document.getElementById('chat-message').value;
            if (message) {
                sendCommand({
                    command: 'chat',
                    args: { message: message }
                });
                document.getElementById('chat-message').value = '';
            }
        }

        function getPlayerPos() {
            sendCommand({
                command: 'getPlayerPosition',
                args: {}
            });
        }

        function buildTower() {
            if (!connected) {
                log('âŒ Minecraftã«æ¥ç¶šã—ã¦ãã ã•ã„');
                return;
            }
            
            log('ğŸ—¼ çŸ³ã®å¡”ã‚’å»ºè¨­ä¸­...');
            const baseX = parseInt(document.getElementById('x-coord').value);
            const baseY = parseInt(document.getElementById('y-coord').value);
            const baseZ = parseInt(document.getElementById('z-coord').value);
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    sendCommand({
                        command: 'setBlock',
                        args: { x: baseX, y: baseY + i, z: baseZ, blockType: 'stone' }
                    });
                }, i * 500);
            }
        }

        function buildWall() {
            if (!connected) {
                log('âŒ Minecraftã«æ¥ç¶šã—ã¦ãã ã•ã„');
                return;
            }
            
            log('ğŸ§± å£ã‚’å»ºè¨­ä¸­...');
            const baseX = parseInt(document.getElementById('x-coord').value);
            const baseY = parseInt(document.getElementById('y-coord').value);
            const baseZ = parseInt(document.getElementById('z-coord').value);
            
            let delay = 0;
            for (let x = 0; x < 5; x++) {
                for (let y = 0; y < 3; y++) {
                    setTimeout(() => {
                        sendCommand({
                            command: 'setBlock',
                            args: { x: baseX + x, y: baseY + y, z: baseZ, blockType: 'cobblestone' }
                        });
                    }, delay * 200);
                    delay++;
                }
            }
        }

        function buildFloor() {
            if (!connected) {
                log('âŒ Minecraftã«æ¥ç¶šã—ã¦ãã ã•ã„');
                return;
            }
            
            log('ğŸŸ« åºŠã‚’å»ºè¨­ä¸­...');
            const baseX = parseInt(document.getElementById('x-coord').value);
            const baseY = parseInt(document.getElementById('y-coord').value);
            const baseZ = parseInt(document.getElementById('z-coord').value);
            
            let delay = 0;
            for (let x = 0; x < 5; x++) {
                for (let z = 0; z < 5; z++) {
                    setTimeout(() => {
                        sendCommand({
                            command: 'setBlock',
                            args: { x: baseX + x, y: baseY, z: baseZ + z, blockType: 'wood' }
                        });
                    }, delay * 100);
                    delay++;
                }
            }
        }

        function addBlock(type) {
            const scriptArea = document.getElementById('script-area');
            const block = document.createElement('div');
            block.className = 'script-block';
            
            switch(type) {
                case 'connect':
                    block.textContent = 'ğŸ”Œ Minecraftã«æ¥ç¶š';
                    block.onclick = () => connectToMinecraft();
                    break;
                case 'place':
                    block.textContent = 'ğŸ§± ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç½®ã';
                    block.onclick = () => placeBlock();
                    break;
                case 'chat':
                    block.textContent = 'ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ';
                    block.onclick = () => sendChat();
                    break;
                case 'wait':
                    block.textContent = 'â³ 1ç§’å¾…ã¤';
                    block.onclick = () => setTimeout(() => log('1ç§’å¾…æ©Ÿå®Œäº†'), 1000);
                    break;
                case 'loop':
                    block.textContent = 'ğŸ”„ 10å›ãã‚Šã‹ãˆã—';
                    break;
            }
            
            scriptArea.appendChild(block);
            script.push(type);
        }

        function runScript() {
            log('â–¶ï¸ ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œé–‹å§‹');
            const blocks = document.querySelectorAll('#script-area .script-block');
            
            let delay = 0;
            blocks.forEach((block, index) => {
                setTimeout(() => {
                    block.style.background = '#FF9800';
                    block.click();
                    setTimeout(() => {
                        block.style.background = '#2196F3';
                    }, 500);
                }, delay * 1000);
                delay++;
            });
        }

        function clearScript() {
            document.getElementById('script-area').innerHTML = 'ã“ã“ã«ãƒ–ãƒ­ãƒƒã‚¯ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—';
            script = [];
            log('ğŸ—‘ï¸ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        // åˆæœŸåŒ–
        window.onload = function() {
            log('Minecraft Controller æº–å‚™å®Œäº†');
            log('1. "ğŸ”Œ æ¥ç¶š" ãƒœã‚¿ãƒ³ã§Minecraftã«æ¥ç¶š');
            log('2. ãƒ–ãƒ­ãƒƒã‚¯ãƒœã‚¿ãƒ³ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ä½œæˆ');
            log('3. "â–¶ï¸ å®Ÿè¡Œ" ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œ');
            
            // è‡ªå‹•æ¥ç¶šè©¦è¡Œ
            setTimeout(connectToMinecraft, 1000);
            
            // å®šæœŸæ¥ç¶šãƒã‚§ãƒƒã‚¯
            setInterval(() => {
                if (!connected) {
                    connectToMinecraft();
                }
            }, 5000);
        };

        window.onbeforeunload = function() {
            if (ws) ws.close();
        };
    </script>
</body>
</html>