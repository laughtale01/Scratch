<!DOCTYPE html>
<html>
<head>
    <title>Minecraft WebSocket Test</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>ğŸ® Minecraft WebSocket Connection Test</h1>
    
    <div>
        <button id="connectBtn">Connect to Minecraft</button>
        <button id="disconnectBtn">Disconnect</button>
        <span id="status">Disconnected</span>
    </div>
    
    <div>
        <h3>Authentication:</h3>
        <button onclick="authenticateTeacher()">ğŸ”‘ Authenticate as Teacher</button>
        <button onclick="authenticateStudent()">ğŸ‘¨â€ğŸ“ Authenticate as Student</button>
    </div>
    
    <div>
        <h3>Development Mode Test (No Auth Required):</h3>
        <button onclick="sendCommand('ping()')">ğŸ“ Ping Test</button>
        <button onclick="sendCommand('chat(DevMode Test!)')">ğŸ’¬ Chat Test</button>
        <button onclick="sendCommand('placeBlock(stone,1,1,1)')">ğŸ§± Place Block Test</button>
    </div>
    
    <div>
        <h3>Send Commands:</h3>
        <button onclick="sendCommand('getPlayerPos()')">Get Position</button>
        <button onclick="sendCommand('chat(Hello from WebSocket!)')">Send Chat</button>
        <button onclick="sendCommand('placeBlock(stone,0,0,0)')">Place Stone Block</button>
    </div>
    
    <div>
        <h3>Manual Command:</h3>
        <input type="text" id="commandInput" placeholder="Enter command" style="width: 300px;">
        <button onclick="sendManualCommand()">Send</button>
    </div>
    
    <div>
        <h3>Messages:</h3>
        <div id="messages" style="border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; background: #f5f5f5;"></div>
    </div>

    <script>
        let socket = null;
        let isConnected = false;
        
        const statusElement = document.getElementById('status');
        const messagesElement = document.getElementById('messages');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            messagesElement.innerHTML += `<div style="color: ${color}; font-family: monospace;">[${timestamp}] ${message}</div>`;
            messagesElement.scrollTop = messagesElement.scrollHeight;
        }
        
        function connect() {
            try {
                socket = new WebSocket('ws://localhost:14711');
                
                socket.onopen = () => {
                    isConnected = true;
                    statusElement.textContent = 'Connected';
                    statusElement.style.color = 'green';
                    log('âœ… WebSocket connected successfully!', 'success');
                };
                
                socket.onmessage = (event) => {
                    log(`ğŸ“¨ Received: ${event.data}`, 'success');
                };
                
                socket.onclose = () => {
                    isConnected = false;
                    statusElement.textContent = 'Disconnected';
                    statusElement.style.color = 'red';
                    log('âŒ WebSocket disconnected', 'error');
                };
                
                socket.onerror = (error) => {
                    log(`ğŸš¨ WebSocket error: ${error}`, 'error');
                };
                
            } catch (error) {
                log(`ğŸš¨ Connection failed: ${error}`, 'error');
            }
        }
        
        function disconnect() {
            if (socket) {
                socket.close();
                socket = null;
            }
        }
        
        function authenticateTeacher() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const authCommand = JSON.stringify({
                    "command": "auth",
                    "username": "testUser"
                });
                log(`ğŸ”‘ Authenticating as teacher with username: testUser`);
                socket.send(authCommand);
            } else {
                log('ğŸš¨ Not connected! Click Connect first.', 'error');
            }
        }
        
        function authenticateStudent() {
            if (socket && socket.readyState === WebSocket.OPEN) {
                const authCommand = JSON.stringify({
                    "command": "auth",
                    "username": "testUser2"
                });
                log(`ğŸ‘¨â€ğŸ“ Authenticating as student with username: testUser2`);
                socket.send(authCommand);
            } else {
                log('ğŸš¨ Not connected! Click Connect first.', 'error');
            }
        }
        
        function sendCommand(command) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                log(`ğŸ“¤ Sending: ${command}`);
                socket.send(command);
            } else {
                log('ğŸš¨ Not connected! Click Connect first.', 'error');
            }
        }
        
        function sendManualCommand() {
            const input = document.getElementById('commandInput');
            const command = input.value.trim();
            if (command) {
                sendCommand(command);
                input.value = '';
            }
        }
        
        document.getElementById('connectBtn').onclick = connect;
        document.getElementById('disconnectBtn').onclick = disconnect;
        
        document.getElementById('commandInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendManualCommand();
            }
        });
        
        log('ğŸ’¡ Click "Connect to Minecraft" to start testing!');
    </script>
</body>
</html>