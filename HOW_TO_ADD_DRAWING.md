# マインクラフト自動描画機能の追加方法

`sokoban_working.sb3` は正常に動作していますので、これをベースに手動で描画機能を追加する方法を説明します。

## 現在の状況

✅ **動作確認済み:** `sokoban_working.sb3`
- 緑の旗をクリック → チャットメッセージ表示
- 矢印キーを押す → チャットメッセージ表示
- 変数 playerX, playerY が正しく変更される

## 目標

矢印キーを押したときに、マインクラフト内のダイヤモンドブロックが自動的に移動するようにします。

---

## 手順1: 初期描画を追加

### 1-1. 「緑の旗がクリックされたとき」のスクリプトを編集

現在:
```
緑の旗がクリックされたとき
minecraft: チャット メッセージ: [倉庫番ゲーム開始！矢印キーで移動]
gameState を [1] にする
```

↓ 以下のブロックを追加:

```
緑の旗がクリックされたとき
minecraft: チャット メッセージ: [倉庫番ゲーム開始！矢印キーで移動]
gameState を [1] にする

// ↓↓↓ ここから追加 ↓↓↓

minecraft: エリアをクリア x: [0] z: [0]

0.5 秒待つ

// プレイヤーブロックを設置
minecraft: ブロックを置く
  x: (playerX)
  y: [1]
  z: (playerY)
  ブロック: [diamond_block ▼]
  配置: [bottom ▼]
  向き: [none ▼]
```

### Scratchでの追加方法

1. **Minecraft拡張ブロック** → 「エリアをクリア」をドラッグ
   - x: `0`
   - z: `0`

2. **制御ブロック** → 「() 秒待つ」をドラッグ
   - `0.5` 秒待つ

3. **Minecraft拡張ブロック** → 「ブロックを置く」をドラッグ
   - x: `playerX` 変数をドラッグ
   - y: `1`
   - z: `playerY` 変数をドラッグ
   - ブロック: `diamond_block`（建築ブロック ▼ から選択）
   - 配置: `bottom`
   - 向き: `none`

---

## 手順2: 矢印キーに描画を追加

### 2-1. 「↑キーが押されたとき」のスクリプトを編集

現在:
```
↑ キーが押されたとき
playerY を [-1] ずつ変える
minecraft: チャット メッセージ: [上に移動]
```

↓ チャットの代わりに描画を追加:

```
↑ キーが押されたとき
playerY を [-1] ずつ変える

// ↓↓↓ チャットを削除して、これを追加 ↓↓↓

minecraft: ブロックを置く
  x: (playerX)
  y: [1]
  z: (playerY)
  ブロック: [diamond_block ▼]
  配置: [bottom ▼]
  向き: [none ▼]
```

### 2-2. 他の矢印キーも同様に編集

**↓キーが押されたとき:**
```
↓ キーが押されたとき
playerY を [1] ずつ変える
minecraft: ブロックを置く (同上)
```

**←キーが押されたとき:**
```
← キーが押されたとき
playerX を [-1] ずつ変える
minecraft: ブロックを置く (同上)
```

**→キーが押されたとき:**
```
→ キーが押されたとき
playerX を [1] ずつ変える
minecraft: ブロックを置く (同上)
```

---

## 完成形のスクリプト

### スクリプト1: 初期化（緑の旗）

```
緑の旗がクリックされたとき
minecraft: チャット メッセージ: [倉庫番ゲーム開始！矢印キーで移動]
gameState を [1] にする
minecraft: エリアをクリア x: [0] z: [0]
0.5 秒待つ
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

### スクリプト2: ↑キー

```
↑ キーが押されたとき
playerY を [-1] ずつ変える
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

### スクリプト3: ↓キー

```
↓ キーが押されたとき
playerY を [1] ずつ変える
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

### スクリプト4: ←キー

```
← キーが押されたとき
playerX を [-1] ずつ変える
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

### スクリプト5: →キー

```
→ キーが押されたとき
playerX を [1] ずつ変える
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

---

## テスト方法

1. **緑の旗をクリック**
   - マインクラフトでチャットメッセージが表示される
   - 0.5秒後、座標 (5, 1, 5) にダイヤモンドブロックが設置される

2. **ブラウザで↑キーを押す**
   - playerY が 4 になる
   - 座標 (5, 1, 4) にダイヤモンドブロックが設置される

3. **ブラウザで→キーを押す**
   - playerX が 6 になる
   - 座標 (6, 1, 4) にダイヤモンドブロックが設置される

4. **マインクラフトで確認**
   - Alt+Tab でマインクラフトに切り替える
   - ダイヤモンドブロックが移動している！

---

## よくある問題と解決方法

### 問題1: ブロックが連続して設置される

**原因:** 前の位置のブロックが残っている

**解決方法:** 移動前の位置を空気ブロックで消す

改良版スクリプト（↑キーの例）:
```
↑ キーが押されたとき

// 現在位置を空気で消す
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [air ▼]

// 座標を更新
playerY を [-1] ずつ変える

// 新しい位置にプレイヤーを描画
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

### 問題2: 移動が速すぎる

**解決方法:** 少し待つ

```
↑ キーが押されたとき
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [air ▼]
playerY を [-1] ずつ変える
0.1 秒待つ  // ← これを追加
minecraft: ブロックを置く x: (playerX) y: [1] z: (playerY) ブロック: [diamond_block ▼]
```

### 問題3: マインクラフト座標がおかしい

**確認事項:**
- baseX, baseY, baseZ が 0 になっているか確認
- playerX, playerY の初期値が 5 になっているか確認
- マインクラフトで `/tp @s 0 -60 0` を実行して原点に移動

---

## 次のステップ

この基本的な移動機能が動作したら、以下を追加できます：

1. **床の描画** - smooth_stone で 10x10 の床を作る
2. **壁の描画** - stone_bricks で壁を作る
3. **箱の配置** - redstone_block で箱を設置
4. **当たり判定** - 壁や箱にぶつからないようにする
5. **クリア判定** - すべての箱がゴールに入ったらクリア

詳しくは `sokoban_implementation_guide.md` を参照してください。

---

## まとめ

**動作確認済みの `sokoban_working.sb3` を手動で編集**する方法が最も確実です。

1. Scratchエディターで `sokoban_working.sb3` を開く
2. 上記の手順に従ってブロックを追加
3. 保存して試す

自動生成されたファイルよりも、手動で編集した方が確実に動作します。

頑張ってください！
