<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="google" content="notranslate">
    <title>Scratch 3.0 GUI - Minecraft Edition</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #4d97ff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            background: white;
            border-radius: 20%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .loading-text {
            font-size: 18px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin-bottom: 20px;
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }
        
        .loading-progress-bar {
            width: 0%;
            height: 100%;
            background: white;
            transition: width 0.3s ease;
        }
        
        /* Scratch GUI ã‚³ãƒ³ãƒ†ãƒŠ */
        #app {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* Scratchã®æ¨™æº–ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨ */
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* éš ã—ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆæ‹¡å¼µæ©Ÿèƒ½ã®äº‹å‰ãƒ­ãƒ¼ãƒ‰ç”¨ï¼‰ */
        .extension-frame {
            display: none;
        }
    </style>
</head>
<body>
    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo">ğŸ®</div>
            <div class="loading-text">Scratch Ã— Minecraft ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="progressBar"></div>
            </div>
        </div>
    </div>
    
    <!-- Scratch GUI ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div id="app"></div>
    
    <!-- æ‹¡å¼µæ©Ÿèƒ½ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ç”¨ã®éš ã—ãƒ•ãƒ¬ãƒ¼ãƒ  -->
    <iframe class="extension-frame" id="extensionFrame"></iframe>
    
    <script>
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
        let progress = 0;
        const progressBar = document.getElementById('progressBar');
        const loadingScreen = document.getElementById('loadingScreen');
        
        function updateProgress(value) {
            progress = Math.min(value, 100);
            progressBar.style.width = progress + '%';
            
            if (progress >= 100) {
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }, 500);
            }
        }
        
        // Scratch GUI ã®ãƒ­ãƒ¼ãƒ‰
        updateProgress(10);
        
        // Scratchã®è¨­å®š
        window.scratchConfig = {
            // Minecraftæ‹¡å¼µæ©Ÿèƒ½ã®URL
            minecraftExtensionURL: 'https://laughtale-scratch-ca803.web.app/minecraft-extension.js',
            
            // ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½
            preloadExtensions: ['minecraft'],
            
            // è‡ªå‹•çš„ã«è¡¨ç¤ºã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã‚«ãƒ†ã‚´ãƒª
            showExtensionCategory: true,
            
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸè¨­å®š
            defaultProject: {
                name: 'Minecraft Project',
                extensions: ['minecraft']
            }
        };
        
        updateProgress(30);
        
        // Scratch GUIã®CDNã‹ã‚‰ãƒ­ãƒ¼ãƒ‰ï¼ˆå®Ÿéš›ã®Scratch GUIï¼‰
        const scratchScript = document.createElement('script');
        scratchScript.src = 'https://unpkg.com/scratch-gui@latest/build/scratch-gui.min.js';
        
        scratchScript.onload = function() {
            updateProgress(60);
            
            // Scratch GUIã®åˆæœŸåŒ–
            if (window.scratch && window.scratch.gui) {
                const appElement = document.getElementById('app');
                
                // GUIã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                window.scratch.gui.render(appElement, {
                    // æ‹¡å¼µæ©Ÿèƒ½ã®è¨­å®š
                    extensionLibraryVisible: true,
                    
                    // VMã®åˆæœŸåŒ–æ™‚ã®å‡¦ç†
                    onVmInit: (vm) => {
                        updateProgress(80);
                        
                        // Minecraftæ‹¡å¼µæ©Ÿèƒ½ã®è‡ªå‹•ãƒ­ãƒ¼ãƒ‰
                        if (window.scratchConfig.minecraftExtensionURL) {
                            vm.extensionManager.loadExtensionURL(
                                window.scratchConfig.minecraftExtensionURL
                            ).then(() => {
                                console.log('âœ… Minecraftæ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
                                updateProgress(100);
                            }).catch((error) => {
                                console.error('âŒ æ‹¡å¼µæ©Ÿèƒ½ã®ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—:', error);
                                updateProgress(100);
                            });
                        } else {
                            updateProgress(100);
                        }
                    },
                    
                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¿å­˜/èª­ã¿è¾¼ã¿
                    onProjectSave: (projectData) => {
                        console.log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿å­˜:', projectData);
                    }
                });
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: iframeç‰ˆã‚’ä½¿ç”¨
                updateProgress(100);
                createFallbackVersion();
            }
        };
        
        scratchScript.onerror = function() {
            // ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸå ´åˆ
            updateProgress(100);
            createFallbackVersion();
        };
        
        document.head.appendChild(scratchScript);
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆã®ä½œæˆ
        function createFallbackVersion() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <iframe 
                    src="https://scratch.mit.edu/projects/editor/" 
                    style="width: 100%; height: 100%; border: none;"
                    allow="camera; microphone"
                ></iframe>
                <div style="position: fixed; bottom: 20px; right: 20px; background: #ff6600; color: white; padding: 10px 20px; border-radius: 20px; font-size: 14px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
                    Minecraftæ‹¡å¼µæ©Ÿèƒ½URL: ${window.scratchConfig.minecraftExtensionURL}
                </div>
            `;
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            // Ctrl+Shift+M ã§Minecraftæ‹¡å¼µæ©Ÿèƒ½ã®æƒ…å ±ã‚’è¡¨ç¤º
            if (e.ctrlKey && e.shiftKey && e.key === 'M') {
                console.log('ğŸ® Minecraft Extension Info:');
                console.log('URL:', window.scratchConfig.minecraftExtensionURL);
                console.log('Status: Loaded');
            }
        });
    </script>
</body>
</html>