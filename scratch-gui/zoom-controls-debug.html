<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« ãƒ‡ãƒãƒƒã‚°æƒ…å ±</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; background: #f0f0f0; border-radius: 5px; }
        .code { background: #333; color: #fff; padding: 15px; border-radius: 5px; font-family: monospace; }
        h2 { color: #2196F3; }
        .issue { background: #ffebee; padding: 10px; margin: 10px 0; border-left: 4px solid #f44336; }
        .solution { background: #e8f5e9; padding: 10px; margin: 10px 0; border-left: 4px solid #4caf50; }
    </style>
</head>
<body>
    <h1>ğŸ” Scratch GUI ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h1>

    <div class="debug-section">
        <h2>å•é¡Œã®æ¦‚è¦</h2>
        <div class="issue">
            <strong>å•é¡Œ1:</strong> ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒè–„ãè¡¨ç¤ºã•ã‚Œã€éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«è¦‹ãˆã‚‹<br>
            <strong>åŸå› :</strong> SVGãƒ•ã‚¡ã‚¤ãƒ«å†…ã® opacity:0.75 è¨­å®š
        </div>
        <div class="issue">
            <strong>å•é¡Œ2:</strong> ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒã‚¯ãƒªãƒƒã‚¯ã§ããªã„<br>
            <strong>åŸå› :</strong> ãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®å•é¡Œ
        </div>
    </div>

    <div class="debug-section">
        <h2>ãƒ‡ãƒãƒƒã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h2>
        <p>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ« (F12) ã§ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€å•é¡Œã‚’è¨ºæ–­ã—ã¦ãã ã•ã„ï¼š</p>
        
        <div class="code">
// ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®çŠ¶æ…‹ã‚’ç¢ºèª
(function debugZoomControls() {
    console.log('=== ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¨ºæ–­é–‹å§‹ ===');
    
    // 1. ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æ¤œç´¢
    const zoomControls = document.querySelectorAll('.blocklyZoom');
    console.log('è¦‹ã¤ã‹ã£ãŸã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ•°:', zoomControls.length);
    
    zoomControls.forEach((zoom, index) => {
        console.log(`\nã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« ${index + 1}:`);
        console.log('- ä¸é€æ˜åº¦:', window.getComputedStyle(zoom).opacity);
        console.log('- ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ:', window.getComputedStyle(zoom).pointerEvents);
        console.log('- è¡¨ç¤ºçŠ¶æ…‹:', window.getComputedStyle(zoom).display);
        
        // ç”»åƒã‚’ç¢ºèª
        const images = zoom.querySelectorAll('image');
        console.log('- ç”»åƒæ•°:', images.length);
        
        images.forEach((img, imgIndex) => {
            console.log(`  ç”»åƒ ${imgIndex + 1}:`, {
                href: img.getAttribute('href') || img.getAttributeNS('http://www.w3.org/1999/xlink', 'href'),
                opacity: img.getAttribute('opacity'),
                style: img.getAttribute('style')
            });
        });
    });
    
    // 2. ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºèª
    if (window.Blockly && window.Blockly.mainWorkspace) {
        console.log('\nãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æƒ…å ±:');
        const workspace = window.Blockly.mainWorkspace;
        console.log('- ãƒ¡ã‚¤ãƒ³ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹:', workspace);
        console.log('- ãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆ:', workspace.getFlyout());
        if (workspace.getFlyout()) {
            console.log('- ãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹:', workspace.getFlyout().getWorkspace());
        }
    }
    
    console.log('=== è¨ºæ–­å®Œäº† ===');
})();
        </div>
    </div>

    <div class="debug-section">
        <h2>æœ€çµ‚ä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</h2>
        <p>ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¦ã€ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ï¼š</p>
        
        <div class="code">
// å®Œå…¨ãªä¿®æ­£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
(function fixAllZoomIssues() {
    console.log('ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ä¿®æ­£ã‚’é–‹å§‹...');
    
    // 1. ã™ã¹ã¦ã®ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’å–å¾—
    const zoomControls = document.querySelectorAll('.blocklyZoom');
    
    if (zoomControls.length === 0) {
        console.error('ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
    }
    
    // 2. å„ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä¿®æ­£
    zoomControls.forEach((zoomGroup, index) => {
        console.log(`ä¿®æ­£ä¸­: ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« ${index + 1}`);
        
        // ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸é€æ˜åº¦ã‚’ä¿®æ­£
        zoomGroup.style.opacity = '1';
        zoomGroup.style.pointerEvents = 'all';
        
        // SVGè¦ç´ ã‚’å–å¾—ã—ã¦ä¿®æ­£
        const svgs = zoomGroup.querySelectorAll('svg');
        svgs.forEach(svg => {
            // SVGå†…ã®ã™ã¹ã¦ã®è¦ç´ ã®ä¸é€æ˜åº¦ã‚’ä¿®æ­£
            svg.querySelectorAll('*').forEach(elem => {
                if (elem.tagName === 'g') {
                    elem.setAttribute('opacity', '1');
                    elem.style.opacity = '1';
                }
            });
        });
        
        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ ï¼ˆãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆç”¨ï¼‰
        if (index === 1 && window.Blockly && window.Blockly.mainWorkspace) {
            const buttons = zoomGroup.querySelectorAll('g[transform]');
            const flyout = window.Blockly.mainWorkspace.getFlyout();
            if (flyout) {
                const flyoutWs = flyout.getWorkspace();
                
                buttons.forEach((button, btnIndex) => {
                    button.style.cursor = 'pointer';
                    button.style.pointerEvents = 'all';
                    
                    // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
                    const newButton = button.cloneNode(true);
                    button.parentNode.replaceChild(newButton, button);
                    
                    // æ–°ã—ã„ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’è¿½åŠ 
                    newButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        e.preventDefault();
                        
                        console.log(`ãƒœã‚¿ãƒ³ ${btnIndex + 1} ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ`);
                        
                        if (btnIndex === 0) { // ã‚ºãƒ¼ãƒ ã‚¤ãƒ³
                            flyoutWs.zoomCenter(1);
                        } else if (btnIndex === 1) { // ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ
                            flyoutWs.zoomCenter(-1);
                        } else if (btnIndex === 2) { // ãƒªã‚»ãƒƒãƒˆ
                            flyoutWs.setScale(1);
                            flyoutWs.scrollCenter();
                        }
                        
                        // ãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆã‚’å†æç”»
                        if (flyout.reflowInternal_) {
                            flyout.reflowInternal_();
                            flyout.position();
                        }
                    });
                });
            }
        }
    });
    
    console.log('âœ… ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸ');
    return 'ä¿®æ­£å®Œäº†';
})();
        </div>
    </div>

    <div class="debug-section">
        <h2>æ ¹æœ¬çš„ãªè§£æ±ºæ–¹æ³•</h2>
        <div class="solution">
            <strong>è§£æ±ºç­–:</strong> Blocklyã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æ­£ã—ãå®Ÿè£…ã™ã‚‹<br>
            <ol>
                <li>SVGãƒ•ã‚¡ã‚¤ãƒ«ã® opacity å•é¡Œã‚’å›é¿ã™ã‚‹ãŸã‚ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³SVGã‚’ä½¿ç”¨</li>
                <li>ãƒ•ãƒ©ã‚¤ã‚¢ã‚¦ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚’é©åˆ‡ã«è¨­å®š</li>
                <li>Blocklyã® bindEventWithChecks_ ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ­£ã—ãä½¿ç”¨</li>
            </ol>
        </div>
    </div>
</body>
</html>